'use strict';const _0x24a1a9=_0x4255;(function(_0x5bf712,_0x175fd1){const _0x39abc0=_0x4255,_0x4297db=_0x5bf712();while(!![]){try{const _0x4c181c=parseInt(_0x39abc0(0x121))/0x1+parseInt(_0x39abc0(0xf2))/0x2+-parseInt(_0x39abc0(0xf1))/0x3+-parseInt(_0x39abc0(0x123))/0x4*(parseInt(_0x39abc0(0x12e))/0x5)+parseInt(_0x39abc0(0xe4))/0x6*(-parseInt(_0x39abc0(0x110))/0x7)+-parseInt(_0x39abc0(0xf7))/0x8+parseInt(_0x39abc0(0xee))/0x9;if(_0x4c181c===_0x175fd1)break;else _0x4297db['push'](_0x4297db['shift']());}catch(_0x5c4ae8){_0x4297db['push'](_0x4297db['shift']());}}}(_0x14c3,0x29586));function _0x4255(_0x5c2235,_0x29085d){const _0x14c3b5=_0x14c3();return _0x4255=function(_0x42555f,_0xdba539){_0x42555f=_0x42555f-0xe2;let _0x339d24=_0x14c3b5[_0x42555f];if(_0x4255['gBzHKA']===undefined){var _0x3cc981=function(_0x58efb4){const _0x371ec1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4b2675='',_0x202116='';for(let _0x2a9fae=0x0,_0x4a999c,_0x63d6e3,_0x137c17=0x0;_0x63d6e3=_0x58efb4['charAt'](_0x137c17++);~_0x63d6e3&&(_0x4a999c=_0x2a9fae%0x4?_0x4a999c*0x40+_0x63d6e3:_0x63d6e3,_0x2a9fae++%0x4)?_0x4b2675+=String['fromCharCode'](0xff&_0x4a999c>>(-0x2*_0x2a9fae&0x6)):0x0){_0x63d6e3=_0x371ec1['indexOf'](_0x63d6e3);}for(let _0x145baf=0x0,_0x88da01=_0x4b2675['length'];_0x145baf<_0x88da01;_0x145baf++){_0x202116+='%'+('00'+_0x4b2675['charCodeAt'](_0x145baf)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x202116);};_0x4255['kvnIEB']=_0x3cc981,_0x5c2235=arguments,_0x4255['gBzHKA']=!![];}const _0x2db564=_0x14c3b5[0x0],_0x40e021=_0x42555f+_0x2db564,_0x4bf25e=_0x5c2235[_0x40e021];return!_0x4bf25e?(_0x339d24=_0x4255['kvnIEB'](_0x339d24),_0x5c2235[_0x40e021]=_0x339d24):_0x339d24=_0x4bf25e,_0x339d24;},_0x4255(_0x5c2235,_0x29085d);}Object[_0x24a1a9(0x125)+_0x24a1a9(0x10d)](exports,_0x24a1a9(0xf0),{'value':!![]}),exports[_0x24a1a9(0x12a)+_0x24a1a9(0x115)+_0x24a1a9(0xec)]=void 0x0;function _0x14c3(){const _0x2746c6=['Dc1szw1HAw5PBG','Bw1VBG','mtG2otyYnfruA3nUrq','C2v0sgvHzgvY','CMf0zuXPBwL0','AgfUzgXL','C3bSAxq','DwiVBMvZDgPZlq','zgvZAwDUoNbHCG','uMvXDwvZDhm','BgLTAxrZlNnLCG','shr0Cfn0yxr1CW','Ec1MB3j3yxjKzq','C3rHDhvZq29Kzq','ChjPC21H','z2v0','CY9SAwnLBNnLlq','uhjPC21Hu2vYDG','AgvHzgvYCW','z3jHCgHXBa','y2HLzdOG','y291BNq','r3fSrxHLy3v0Aq','qg5LC3rQCY9JBW','zxj0Eq','ve9px01btLLFuG','z2v0uMvZCg9UCW','mtuWndn4ugrwueG','vg9Vig1HBNKGCG','zc1MB3i','yw10ExbLCW','C2TPCfn1y2nLCW','AxrjBNrLCMnLCa','rvfvrvnuuW','z2v0q3vYCMvUDa','zxnZ','y2vPBa','yxbOCwW','DgfW','CMf0zv9SAw1PDa','z2v0q2XPzw50sW','C3rVCMu','CMvZzxruAw1L','zeXPBwL0CW','mZy5mJzLy2nmwe4','CMvX','mJu2nJrgr2rSs2K','lI4VC2vYDMLJzq','zgvMAw5LuhjVCa','tgLTAxrZ','igXPBwL0ihjLyq','CMf0zuXPBwL0tW','Aw50zxjJzxb0','tgLJzw5ZzuXPBq','C3DPDgnOvg9iDa','DhjPBq','zxf1zxn0CW','ndbZDhHhsuq','B25dB250zxH0','uMv0CNKTqwz0zq','EgnLChrPB24','C2TPCezHAwXLza','z2v0q29UDgv4Da','z2v0uMvXDwvZDa','AxrZu2vYDMLJzq','y3jLyxrL','Dg9mB3DLCKnHCW','sw5Qzwn0ywjSzq','y2HLy2TszwnVCG','rM9YyMLKzgvUrq','ntuYDMTQrLfh','x19TzxrHzgf0yq','qhjZlxrLy2GTAa','Bwf4uMvJB3jKCW','AwnL','DMLJzq','x19KzwnVCMf0zq','ChrPB25Z','Dg9Y','Aw9U','nZyXotuZnuLhwevPEq','Dc1szxnLDa','x19LC01VzhvSzq','odq3otq3BgT0EvnM','mtaYmZK0vwrZA1nV','Dc1xAw5KB3C','BgLTAxrZu2vYDG'];_0x14c3=function(){return _0x2746c6;};return _0x14c3();}const tslib_1=require('tslib'),common_1=require(_0x24a1a9(0x10c)+_0x24a1a9(0xf6)),graphql_1=require('@nestjs/gr'+_0x24a1a9(0x11a)),nestjs_prisma_1=require(_0x24a1a9(0xe6)+_0x24a1a9(0xfc)+_0x24a1a9(0x103)),rxjs_1=require('rxjs'),license_limits_service_1=require(_0x24a1a9(0x124)+_0x24a1a9(0x105)+_0x24a1a9(0xff)+_0x24a1a9(0xe9));let LicenseLimitInterceptor=class LicenseLimitInterceptor{[_0x24a1a9(0xf4)+_0x24a1a9(0xe8)];[_0x24a1a9(0x103)];constructor(_0x58efb4,_0x371ec1){const _0x1f5138=_0x24a1a9;this[_0x1f5138(0xf4)+_0x1f5138(0xe8)]=_0x58efb4,this[_0x1f5138(0x103)]=_0x371ec1;}[_0x24a1a9(0x11e)]=new Map();[_0x24a1a9(0x128)+_0x24a1a9(0xeb)]={'windowMs':0xea60,'headers':!![],'skipSuccessfulRequests':![],'skipFailedRequests':![]};async[_0x24a1a9(0x129)](_0x4b2675,_0x202116){const _0x41cd3d=_0x24a1a9,_0x2a9fae=this['limitsServ'+_0x41cd3d(0xe8)][_0x41cd3d(0x117)+_0x41cd3d(0x126)]();if(_0x2a9fae['isUnlimite'+'d'])return _0x202116[_0x41cd3d(0xfa)]();return await this['checkRecor'+_0x41cd3d(0x120)](_0x2a9fae),await this[_0x41cd3d(0xf9)](_0x4b2675,_0x202116,_0x2a9fae);}async[_0x24a1a9(0xe2)+_0x24a1a9(0x120)](_0x4a999c){const _0x5f150b=_0x24a1a9,_0x63d6e3=_0x4a999c[_0x5f150b(0xe7)]||[];for(const {model:_0x137c17,limit:_0x145baf}of _0x63d6e3){const _0x88da01=await this[_0x5f150b(0x103)][_0x137c17[_0x5f150b(0x137)+'e']()][_0x5f150b(0x10a)]();if(!_0x88da01)continue;if(_0x145baf&&_0x88da01>=_0x145baf)throw new common_1[(_0x5f150b(0xe3))+(_0x5f150b(0x131))](_0x137c17+(_0x5f150b(0x127)+_0x5f150b(0x109))+_0x145baf);}}async[_0x24a1a9(0xf9)](_0x4bcc9f,_0x5c41b6,_0x4685a3){const _0x14e9bb=_0x24a1a9,_0x4c409d=_0x4bcc9f['getType']();let _0x19f1a4,_0x3411a1;if(_0x4c409d===_0x14e9bb(0x108)){const _0x47cedb=graphql_1[_0x14e9bb(0x10b)+_0x14e9bb(0x12f)][_0x14e9bb(0x136)](_0x4bcc9f),_0x31b7b6=_0x47cedb[_0x14e9bb(0x133)]();_0x19f1a4=_0x31b7b6[_0x14e9bb(0x122)],_0x3411a1=_0x31b7b6['res'];}else{if(_0x4c409d==='http')_0x19f1a4=_0x4bcc9f[_0x14e9bb(0x12b)+'tp']()[_0x14e9bb(0x134)](),_0x3411a1=_0x4bcc9f[_0x14e9bb(0x12b)+'tp']()[_0x14e9bb(0x10f)+'e']();else return _0x5c41b6[_0x14e9bb(0xfa)]();}if(!_0x19f1a4||!_0x3411a1)return _0x5c41b6[_0x14e9bb(0xfa)]();const _0x22380e=this[_0x14e9bb(0x11d)+'ey'](_0x19f1a4),_0xe11699=Date['now'](),_0x36834e=this[_0x14e9bb(0x128)+_0x14e9bb(0xeb)]['windowMs'],_0x330f04=_0x4685a3['rateLimit']?parseInt(_0x4685a3['rateLimit']['split']('/')[0x0],0xa):0x64;let _0x2c63c3=this[_0x14e9bb(0x11e)][_0x14e9bb(0x104)](_0x22380e);(!_0x2c63c3||_0xe11699>_0x2c63c3[_0x14e9bb(0x11f)])&&(_0x2c63c3={'count':0x0,'resetTime':_0xe11699+_0x36834e},this['store']['set'](_0x22380e,_0x2c63c3));_0x2c63c3[_0x14e9bb(0x10a)]++;const _0x532cb7=Math['max'](0x0,_0x330f04-_0x2c63c3[_0x14e9bb(0x10a)]),_0x69fa16=Math[_0x14e9bb(0x119)](_0x2c63c3[_0x14e9bb(0x11f)]/0x3e8);this[_0x14e9bb(0x128)+'ptions'][_0x14e9bb(0x107)]!==![]&&(_0x3411a1[_0x14e9bb(0xf8)]('X-RateLimi'+'t-Limit',_0x330f04),_0x3411a1[_0x14e9bb(0xf8)]('X-RateLimi'+_0x14e9bb(0xf5)+'g',_0x532cb7),_0x3411a1[_0x14e9bb(0xf8)]('X-RateLimi'+_0x14e9bb(0xef),_0x69fa16),_0x3411a1['setHeader']('X-RateLimi'+_0x14e9bb(0xf3),Math[_0x14e9bb(0x119)](_0x36834e/0x3e8)));if(_0x2c63c3[_0x14e9bb(0x10a)]>_0x330f04){_0x3411a1[_0x14e9bb(0xf8)](_0x14e9bb(0x130)+'r',Math['ceil']((_0x2c63c3[_0x14e9bb(0x11f)]-_0xe11699)/0x3e8));throw new common_1['HttpExcept'+(_0x14e9bb(0xed))](_0x14e9bb(0x111)+_0x14e9bb(0x12d),common_1[_0x14e9bb(0x100)][_0x14e9bb(0x10e)+_0x14e9bb(0x116)]);}return _0x5c41b6['handle']()['pipe']((0x0,rxjs_1['tap'])(()=>{const _0x437104=_0x14e9bb;this['rateLimitO'+_0x437104(0xeb)][_0x437104(0x114)+'sfulReques'+'ts']&&_0x3411a1[_0x437104(0x102)]<0x190&&_0x2c63c3['count']--;}),(0x0,rxjs_1[_0x14e9bb(0x11b)])(undefined,_0x2199dc=>{const _0x4d33b8=_0x14e9bb;this[_0x4d33b8(0x128)+_0x4d33b8(0xeb)][_0x4d33b8(0x132)+_0x4d33b8(0xfe)]&&_0x2c63c3[_0x4d33b8(0x10a)]--;}));}['getClientK'+'ey'](_0x5ad6c2){const _0x3e9d73=_0x24a1a9,_0x2f5823=_0x5ad6c2[_0x3e9d73(0x107)][_0x3e9d73(0x101)+_0x3e9d73(0x112)],_0x1514b5=_0x2f5823?_0x2f5823[_0x3e9d73(0xfb)](',')[0x0][_0x3e9d73(0x12c)]():_0x5ad6c2['connection']['remoteAddr'+_0x3e9d73(0x118)];return _0x3e9d73(0x11c)+':'+_0x1514b5;}};exports['LicenseLim'+_0x24a1a9(0x115)+_0x24a1a9(0xec)]=LicenseLimitInterceptor,exports[_0x24a1a9(0x12a)+_0x24a1a9(0x115)+_0x24a1a9(0xec)]=LicenseLimitInterceptor=tslib_1[_0x24a1a9(0xea)]([(0x0,common_1[_0x24a1a9(0x138)])(),tslib_1[_0x24a1a9(0xe5)](_0x24a1a9(0xfd)+_0x24a1a9(0x113),[license_limits_service_1['LicenseLim'+_0x24a1a9(0x135)],nestjs_prisma_1[_0x24a1a9(0x106)+_0x24a1a9(0xe8)]])],LicenseLimitInterceptor);