'use strict';const _0x4f021f=_0x522a;(function(_0x990d9c,_0x34df41){const _0x357714=_0x522a,_0x2b81da=_0x990d9c();while(!![]){try{const _0x5c9b84=-parseInt(_0x357714(0x136))/0x1*(-parseInt(_0x357714(0x158))/0x2)+-parseInt(_0x357714(0x150))/0x3*(-parseInt(_0x357714(0x127))/0x4)+parseInt(_0x357714(0x145))/0x5*(-parseInt(_0x357714(0x135))/0x6)+parseInt(_0x357714(0x16f))/0x7+-parseInt(_0x357714(0x17b))/0x8+parseInt(_0x357714(0x141))/0x9+-parseInt(_0x357714(0x14a))/0xa*(parseInt(_0x357714(0x131))/0xb);if(_0x5c9b84===_0x34df41)break;else _0x2b81da['push'](_0x2b81da['shift']());}catch(_0x2bde56){_0x2b81da['push'](_0x2b81da['shift']());}}}(_0x3d0d,0x5edf2));var ActivationTokenService_1;Object['defineProp'+'erty'](exports,_0x4f021f(0x12f),{'value':!![]}),exports['Activation'+'TokenServi'+'ce']=void 0x0;const tslib_1=require(_0x4f021f(0x17d)),common_1=require(_0x4f021f(0x15e)+_0x4f021f(0x14c)),nestjs_clock_1=require('@rs-tech-h'+_0x4f021f(0x174)+'clock'),nestjs_service_operation_1=require(_0x4f021f(0x15b)+_0x4f021f(0x174)+'service-op'+_0x4f021f(0x138)),crypto=tslib_1[_0x4f021f(0x183)+'ar'](require('crypto')),activation_token_repository_1=require(_0x4f021f(0x12c)+'on-token.r'+_0x4f021f(0x147)),errors_1=require(_0x4f021f(0x169));function _0x3d0d(){const _0x3181e8=['lxrVA2vUCW','qhjZlxrLy2GTAa','Dg9tDhjPBMC','tg9Nz2vY','qg5LC3rQCY9JBW','Aw52ywXPzgf0zq','BgvHBNvWig9Mia','zxzVA2vKl3vZzq','B24GDg9Rzw5ZlG','igzVCIb1C2vYia','ywn0AxzHDgLVBG','zgf0zs4','lxrVA2vU','DxnLzef0','uhjLDMLVDxnvCW','lI9LCNjVCNm','y3jLyxrLsgfZAa','DM9RzwqVDxnLza','yxrL','q2XVy2Ttzxj2Aq','Aw9UihrVA2vUCW','mZi2mZC3oeDsqMfyua','CMfUzg9TqNL0zq','BgvUz3rO','x19TzxrHzgf0yq','zgLNzxn0','DwiVBMvZDgPZlq','u2vYDMLJzuzHyW','B3iGDxnLCIa','CMv2B2TLzef0','C2HHmJu2','t1jFve9lru5FtG','Bg9Nz2vY','mJa1mtu4ngn5B1bnsW','Agv4','DhnSAwi','AwXPDgf0B3jtzq','BIb0B2TLBNmGzG','DMLJzs1JBgvHBG','tM8Gywn0AxzHDa','BNmTzM9YlxvZzq','x19PBxbVCNrtDa','zMLUze9UzvDPDa','Bg9N','t1jFsu5wquXjra','CNzPy2u','C2v0rgf0zq','z2v0rgf0zq','yw10ExbLCW','igrHExmU','zxjuB2TLBNm','t1rFrK9vtKq','rxH0CMfJDa','y2XVy2S','mtaWnZzYs1vlv0e','igfJDgL2yxrPBW','AxjLzfrVA2vUCW','y3jLyxrL','DxbKyxrL','lI9Hy3rPDMf0Aq','vg9Rzw5tzxj2Aq','AwXPDgf0B3i','x19LC01VzhvSzq','zcbHy3rPDMf0Aq','nda2nZqYnMzAzLztBq','BM93rgf0zq','ihrVigLUDMfSAq','x1rps0vox0vsuG','nJzhsM9nzxa','mZH1v2T3qNm','zxHLy3v0zufUza','zxjHDgLVBG','y2XLyw51Cev4Ca','qunusvzbveLptG','y291BNq','C2vYDMLJzuzHyW','u3rHCNrPBMCGyW','q2XLyw5Lzcb1Ca','vg9Rzw5szxbVCW','AxrVCNK','mZy1odq3m2XNquL2Aq','AfnLBgvJDa','DxaTzxHWAxjLza','BMCGywn0AxzHDa','mtGWota1sMHgsfDU','DMLJzs1JCMvHDa','zxbVC2L0B3j5','BNrPB24GCgvYAq','DMvYAwz5','mtbjuhjLEKS','zMLUze1HBNK','Bw1VBG','DMLJzs1PBNzHBa','y2uTDMvYAwz5lq','AxrOigeGCMv0zq','nJbdquHRze0','B2qGB2yG','qwn0AxzHDgLVBG','iezVDw5Kia','sw52ywXPzgf0Aq','lxrVA2vUlxnLCG','igv4CgLYzwqVCG','x19KzwnVCMf0zq','mJu3nZjOEvHRu3C','Aw9UihrVA2vUia'];_0x3d0d=function(){return _0x3181e8;};return _0x3d0d();}let ActivationTokenService=ActivationTokenService_1=class ActivationTokenService{['activation'+_0x4f021f(0x13f)+_0x4f021f(0x140)];[_0x4f021f(0x13c)+_0x4f021f(0x12e)];[_0x4f021f(0x126)];['logger']=new common_1[(_0x4f021f(0x15d))](ActivationTokenService_1['name']);constructor(_0x5e2500,_0x12a19e,_0x56f663){const _0x1370fd=_0x4f021f;this['activation'+_0x1370fd(0x13f)+_0x1370fd(0x140)]=_0x5e2500,this[_0x1370fd(0x13c)+_0x1370fd(0x12e)]=_0x12a19e,this[_0x1370fd(0x126)]=_0x56f663;}async[_0x4f021f(0x12a)](_0x13417c){const _0x31db01=_0x4f021f;return await this[_0x31db01(0x13c)+'ilitator'][_0x31db01(0x137)+_0x31db01(0x18e)](_0x31db01(0x164)+'-token-ser'+_0x31db01(0x146)+'e',async()=>{const _0x597106=_0x31db01,_0x36547d=crypto[_0x597106(0x170)+'s'](0x20)[_0x597106(0x15c)](_0x597106(0x17c)),_0x34a3f8=crypto[_0x597106(0x16a)](_0x597106(0x178))[_0x597106(0x12b)](_0x36547d)[_0x597106(0x173)](_0x597106(0x17c)),_0x330a3b=this['clock'][_0x597106(0x132)]();_0x330a3b[_0x597106(0x188)](_0x330a3b[_0x597106(0x189)]()+0x2);const _0x4e08db=await this[_0x597106(0x164)+_0x597106(0x13f)+_0x597106(0x140)]['create']({'tokenHash':_0x34a3f8,'expiresAt':_0x330a3b,'userId':_0x13417c});return{'activationKey':_0x36547d,..._0x4e08db};});}async['validate'](_0x2b01ea){const _0x347d9f=_0x4f021f;return await this[_0x347d9f(0x13c)+_0x347d9f(0x12e)][_0x347d9f(0x137)+_0x347d9f(0x18e)](_0x347d9f(0x164)+_0x347d9f(0x155)+'vice-valid'+_0x347d9f(0x16c),async()=>{const _0x461429=_0x347d9f,{activationKey:_0x837a7b,userId:_0x3170b3}=_0x2b01ea,_0x16b871=await this[_0x461429(0x164)+'TokenRepos'+_0x461429(0x140)][_0x461429(0x184)+_0x461429(0x142)]({'userId':_0x3170b3,'revokedAt':null,'usedAt':null},{'id':!![],'tokenHash':!![]});if(!_0x16b871)throw new Error(errors_1[_0x461429(0x13a)+_0x461429(0x134)+_0x461429(0x179)+_0x461429(0x18d)]);const _0x4c849f=await this[_0x461429(0x149)]({'activationKey':_0x837a7b,'tokenHash':_0x16b871['tokenHash']});if(!_0x4c849f)throw new Error(errors_1[_0x461429(0x13a)+_0x461429(0x134)+_0x461429(0x186)+'_TOKEN']);else return await this[_0x461429(0x164)+_0x461429(0x13f)+_0x461429(0x140)][_0x461429(0x12b)]({'id':_0x16b871['id']},{'usedAt':this['clock'][_0x461429(0x132)]()}),!![];});}async[_0x4f021f(0x149)](_0x215b95){const _0x5bc6f1=_0x4f021f;return await this[_0x5bc6f1(0x13c)+_0x5bc6f1(0x12e)][_0x5bc6f1(0x137)+'Extract']('auth-servi'+_0x5bc6f1(0x14e)+_0x5bc6f1(0x164)+_0x5bc6f1(0x166),async()=>{const _0x10d5fe=_0x5bc6f1,{activationKey:_0x5a001b,tokenHash:_0x1881a2}=_0x215b95,_0x3200cf=crypto[_0x10d5fe(0x16a)](_0x10d5fe(0x178))[_0x10d5fe(0x12b)](_0x5a001b)['digest'](_0x10d5fe(0x17c));if(_0x3200cf!==_0x1881a2)return![];return!![];},_0x215b95);}async[_0x4f021f(0x15f)+_0x4f021f(0x168)+_0x4f021f(0x18c)](_0x3293ab){const _0x1215c4=_0x4f021f;return await this[_0x1215c4(0x13c)+_0x1215c4(0x12e)][_0x1215c4(0x137)+_0x1215c4(0x18e)](_0x1215c4(0x164)+_0x1215c4(0x155)+_0x1215c4(0x14d)+'idate-toke'+_0x1215c4(0x182)+'r',async()=>{const _0x663b3b=_0x1215c4,_0x575e5b=await this[_0x663b3b(0x164)+_0x663b3b(0x13f)+_0x663b3b(0x140)][_0x663b3b(0x14b)]({'userId':_0x3293ab});if(!_0x575e5b||_0x575e5b[_0x663b3b(0x171)]===0x0)return this[_0x663b3b(0x17a)][_0x663b3b(0x185)](_0x663b3b(0x181)+_0x663b3b(0x16e)+'\x20found\x20for'+'\x20user\x20'+_0x3293ab+(_0x663b3b(0x133)+_0x663b3b(0x165)),_0x663b3b(0x152)+_0x663b3b(0x12d)+'ce'),![];this[_0x663b3b(0x17a)][_0x663b3b(0x185)](_0x663b3b(0x153)+_0x575e5b['length']+(_0x663b3b(0x128)+_0x663b3b(0x17f)+_0x663b3b(0x176))+_0x3293ab+(_0x663b3b(0x133)+_0x663b3b(0x165)));for(const _0x3d748f of _0x575e5b){this[_0x663b3b(0x17a)][_0x663b3b(0x185)](_0x663b3b(0x154)+_0x663b3b(0x144)+_0x663b3b(0x159)+_0x3d748f['id']+_0x663b3b(0x163)+_0x3293ab+'.',_0x663b3b(0x152)+'TokenServi'+'ce'),_0x3d748f[_0x663b3b(0x177)]===null&&_0x3d748f[_0x663b3b(0x167)]===null&&await this[_0x663b3b(0x164)+'TokenRepos'+_0x663b3b(0x140)][_0x663b3b(0x12b)]({'id':_0x3d748f['id']},{'isRevoked':!![],'revokedAt':this['clock'][_0x663b3b(0x132)]()});}return!![];},_0x3293ab);}async[_0x4f021f(0x139)+_0x4f021f(0x129)](){const _0x1ef898=_0x4f021f;return await this[_0x1ef898(0x13c)+_0x1ef898(0x12e)][_0x1ef898(0x137)+'Extract'](_0x1ef898(0x164)+_0x1ef898(0x155)+_0x1ef898(0x180)+_0x1ef898(0x143)+_0x1ef898(0x15a),async()=>{const _0x5cb7b5=_0x1ef898,_0x4f8425=0x3c;this[_0x5cb7b5(0x17a)][_0x5cb7b5(0x185)](_0x5cb7b5(0x13d)+_0x5cb7b5(0x160)+'expired/re'+_0x5cb7b5(0x16b)+_0x5cb7b5(0x128)+'n\x20tokens\x20w'+_0x5cb7b5(0x14f)+_0x5cb7b5(0x148)+_0x5cb7b5(0x151)+_0x4f8425+_0x5cb7b5(0x18b));const _0x396216=this[_0x5cb7b5(0x126)][_0x5cb7b5(0x132)]();_0x396216['setDate'](_0x396216['getDate']()-_0x4f8425);const _0x3f920b=await this[_0x5cb7b5(0x164)+_0x5cb7b5(0x13f)+_0x5cb7b5(0x140)]['deleteMany']({'OR':[{'expiresAt':{'lt':_0x396216}},{'revokedAt':{'lt':_0x396216}},{'usedAt':{'lt':_0x396216}}]});if(_0x3f920b['count']>0x0)return this[_0x5cb7b5(0x17a)]['log'](_0x5cb7b5(0x13e)+'\x20'+_0x3f920b[_0x5cb7b5(0x13b)]+(_0x5cb7b5(0x156)+_0x5cb7b5(0x161)+_0x5cb7b5(0x130)+_0x5cb7b5(0x162))),{'success':!![],'count':_0x3f920b[_0x5cb7b5(0x13b)]};return{'success':![],'count':_0x3f920b[_0x5cb7b5(0x13b)]};});}};function _0x522a(_0x1bde5d,_0xdafb71){const _0x3d0d94=_0x3d0d();return _0x522a=function(_0x522ada,_0x1cc762){_0x522ada=_0x522ada-0x126;let _0x46743d=_0x3d0d94[_0x522ada];if(_0x522a['qcAOUI']===undefined){var _0x2fd46a=function(_0x5e2500){const _0x12a19e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x56f663='',_0x13417c='';for(let _0x36547d=0x0,_0x34a3f8,_0x330a3b,_0x4e08db=0x0;_0x330a3b=_0x5e2500['charAt'](_0x4e08db++);~_0x330a3b&&(_0x34a3f8=_0x36547d%0x4?_0x34a3f8*0x40+_0x330a3b:_0x330a3b,_0x36547d++%0x4)?_0x56f663+=String['fromCharCode'](0xff&_0x34a3f8>>(-0x2*_0x36547d&0x6)):0x0){_0x330a3b=_0x12a19e['indexOf'](_0x330a3b);}for(let _0x2b01ea=0x0,_0x837a7b=_0x56f663['length'];_0x2b01ea<_0x837a7b;_0x2b01ea++){_0x13417c+='%'+('00'+_0x56f663['charCodeAt'](_0x2b01ea)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x13417c);};_0x522a['VeoKTd']=_0x2fd46a,_0x1bde5d=arguments,_0x522a['qcAOUI']=!![];}const _0x50e7be=_0x3d0d94[0x0],_0x1fb499=_0x522ada+_0x50e7be,_0x40ddf4=_0x1bde5d[_0x1fb499];return!_0x40ddf4?(_0x46743d=_0x522a['VeoKTd'](_0x46743d),_0x1bde5d[_0x1fb499]=_0x46743d):_0x46743d=_0x40ddf4,_0x46743d;},_0x522a(_0x1bde5d,_0xdafb71);}exports[_0x4f021f(0x152)+'TokenServi'+'ce']=ActivationTokenService,exports[_0x4f021f(0x152)+'TokenServi'+'ce']=ActivationTokenService=ActivationTokenService_1=tslib_1[_0x4f021f(0x157)]([(0x0,common_1['Injectable'])(),tslib_1[_0x4f021f(0x172)]('design:par'+_0x4f021f(0x18a),[activation_token_repository_1['Activation'+_0x4f021f(0x13f)+_0x4f021f(0x140)],nestjs_service_operation_1[_0x4f021f(0x175)+_0x4f021f(0x17e)+_0x4f021f(0x187)],nestjs_clock_1[_0x4f021f(0x16d)+'ce']])],ActivationTokenService);