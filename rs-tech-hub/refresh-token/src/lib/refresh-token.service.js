'use strict';const _0x38f6a8=_0x8cca;function _0x5730(){const _0x11d0a7=['q2XVy2Ttzxj2Aq','vg9Rzw5tzxj2Aq','Bw1VBG','zs1LEhbPCMvKlq','CNzPy2u','vg9Rzw4GBM90ia','Bg9Nz2vY','zM91BMqGB3iGyq','Aw9U','tM8Gywn0AxzLia','zM91BMq','lI9YzwzYzxnOlq','zgvSzxrLrxHWAq','zw5szxbVC2L0BW','CMv2B2TLvg9Rzq','zw5ZlwzVCI11CW','zxHLy3v0zufUza','B2TLza','ChvZAa','x19KzwnVCMf0zq','BgvJDa','zMLUzej5vg9Rzq','q2XLyw5Lzcb1Ca','Dg9Rzw4UCMvWBW','yw10ExbLCW','y291BNq','BM93rgf0zq','DgHtzwXLy3q','AwXPDgf0B3i','ndK5odaWmfrAy2vmuG','Dg9YEs1MAw5Klq','mJrvB2rUAwK','mti5mdq4mZbkANHszue','uMvMCMvZAfrVAW','CMvMCMvZAfrVAW','y2XLyw51Cev4Ca','qNLuB2TLBG','Dg9YEs1YzxzVAW','zw5ZlwnSzwfUDq','y3jLyxrLuMvMCG','zxnOvg9Rzw4','DxbKyxrL','z2v0rgf0zq','AwXPDgf0B3jtzq','zgvSzxrLtwfUEq','Dg9YEs1KzwXLDa','BhjLywr5ihjLDG','ywn0AxzLlxrVAW','vg9Rzw5ZrM9Yvq','x19TzxrHzgf0yq','CMv0zw50Aw9Uia','C2vYDMLJzuzHyW','DMLJzu9WzxjHDa','qg5LC3rQCY9JBW','zs10B2TLBI1IEq','tg9Nz2vY','CMvKqw5KuMv2BW','zMLUzefJDgL2zq','zNjLC2GGDg9Rzq','DhnSAwi','mteWnJqXm2L6zM5pzq','A2vUlxnLCNzPyW','mJq3mdm2Dhzcq21J','zw5tzxj2AwnL','CMvMCMvZAc10BW','BgWTDxnLCI10BW','zgvMAw5LuhjVCa','C2vY','BNmGD2L0AcbHia','BMqGzM9YihvZzq','zxjHDgLVBG','rxH0CMfJDa','qhjZlxrLy2GTAa','A2vKvg9Rzw5Z','zMLUze1HBNLxAq','mJu1ndC3nhD4y05Trq','C2vYDMLJzs1VCa','zMLUzfvZzxjjza','DwiVBMvZDgPZlq','igrHExmU','BgvUz3rO','mZbrBeDjDum','mtaXmdaXodr6DxPUCeq','zs10B2TLBG','Bg9N','zc10B2TLBNm','Dg9Rzw5ZigzVDq','l3vZzwqGywn0Aq','ndiXmJGXnZb6quP5rhK','A2vUCW','BKj5vMfSDwu','zMLUzfDPDgHtzq','A2vUlxjLCg9ZAq','AxjLzfrVA2vUCW','C2L0B3j5','qwn0AxzHDgLVBG','zxj0Eq','igv4CgLYzwqVAq','DxvPza','y3jLyxrL','mxDyBfvjrq','zs1YzxzVA2uTyq','y2XVy2S'];_0x5730=function(){return _0x11d0a7;};return _0x5730();}(function(_0x4eaffd,_0x208560){const _0xafc0a7=_0x8cca,_0x3ce57c=_0x4eaffd();while(!![]){try{const _0x1cc7cd=-parseInt(_0xafc0a7(0x208))/0x1*(-parseInt(_0xafc0a7(0x1ef))/0x2)+parseInt(_0xafc0a7(0x1f5))/0x3*(-parseInt(_0xafc0a7(0x1e2))/0x4)+parseInt(_0xafc0a7(0x1c1))/0x5+-parseInt(_0xafc0a7(0x1c3))/0x6*(-parseInt(_0xafc0a7(0x1e0))/0x7)+parseInt(_0xafc0a7(0x1f6))/0x8+parseInt(_0xafc0a7(0x1c4))/0x9+-parseInt(_0xafc0a7(0x1fc))/0xa;if(_0x1cc7cd===_0x208560)break;else _0x3ce57c['push'](_0x3ce57c['shift']());}catch(_0x58ccf2){_0x3ce57c['push'](_0x3ce57c['shift']());}}}(_0x5730,0xbd429));function _0x8cca(_0x14908a,_0x3e73cf){const _0x573035=_0x5730();return _0x8cca=function(_0x8cca9,_0x19b423){_0x8cca9=_0x8cca9-0x1af;let _0x4db9da=_0x573035[_0x8cca9];if(_0x8cca['dgpYZi']===undefined){var _0x5acd61=function(_0x51f596){const _0x5b7bed='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x21c530='',_0x5eb897='';for(let _0x1888ce=0x0,_0x19aa4e,_0x3f5d64,_0x2eeed8=0x0;_0x3f5d64=_0x51f596['charAt'](_0x2eeed8++);~_0x3f5d64&&(_0x19aa4e=_0x1888ce%0x4?_0x19aa4e*0x40+_0x3f5d64:_0x3f5d64,_0x1888ce++%0x4)?_0x21c530+=String['fromCharCode'](0xff&_0x19aa4e>>(-0x2*_0x1888ce&0x6)):0x0){_0x3f5d64=_0x5b7bed['indexOf'](_0x3f5d64);}for(let _0x20d298=0x0,_0x47d0bd=_0x21c530['length'];_0x20d298<_0x47d0bd;_0x20d298++){_0x5eb897+='%'+('00'+_0x21c530['charCodeAt'](_0x20d298)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5eb897);};_0x8cca['OXisxb']=_0x5acd61,_0x14908a=arguments,_0x8cca['dgpYZi']=!![];}const _0x13336e=_0x573035[0x0],_0x3f361e=_0x8cca9+_0x13336e,_0x1f64d9=_0x14908a[_0x3f361e];return!_0x1f64d9?(_0x4db9da=_0x8cca['OXisxb'](_0x4db9da),_0x14908a[_0x3f361e]=_0x4db9da):_0x4db9da=_0x1f64d9,_0x4db9da;},_0x8cca(_0x14908a,_0x3e73cf);}var RefreshTokenService_1;Object[_0x38f6a8(0x1e6)+_0x38f6a8(0x204)](exports,'__esModule',{'value':!![]}),exports[_0x38f6a8(0x1c5)+_0x38f6a8(0x1e3)]=void 0x0;const tslib_1=require(_0x38f6a8(0x1df)),common_1=require(_0x38f6a8(0x1d9)+_0x38f6a8(0x20d)),nestjs_clock_1=require(_0x38f6a8(0x1ec)+_0x38f6a8(0x1f2)+_0x38f6a8(0x20a)),nestjs_service_operation_1=require('@rs-tech-h'+'ub/nestjs-'+_0x38f6a8(0x1f0)+_0x38f6a8(0x1ea)),uuid_1=require(_0x38f6a8(0x206)),refresh_token_repository_1=require(_0x38f6a8(0x1af)+_0x38f6a8(0x1bb)+_0x38f6a8(0x202));let RefreshTokenService=RefreshTokenService_1=class RefreshTokenService{[_0x38f6a8(0x20a)];[_0x38f6a8(0x1d7)+_0x38f6a8(0x1c0)];[_0x38f6a8(0x1c6)+_0x38f6a8(0x1b1)+'ry'];[_0x38f6a8(0x211)]=new common_1[(_0x38f6a8(0x1db))](RefreshTokenService_1['name']);constructor(_0x51f596,_0x5b7bed,_0x21c530){const _0x15c2e4=_0x38f6a8;this[_0x15c2e4(0x20a)]=_0x51f596,this[_0x15c2e4(0x1d7)+_0x15c2e4(0x1c0)]=_0x5b7bed,this[_0x15c2e4(0x1c6)+_0x15c2e4(0x1b1)+'ry']=_0x21c530;}async[_0x38f6a8(0x1cb)+_0x38f6a8(0x1cc)](_0x5eb897,_0x1888ce=0x7){const _0x13b71b=_0x38f6a8,_0x19aa4e=(0x0,uuid_1['v4'])(),_0x3f5d64=this[_0x13b71b(0x20a)][_0x13b71b(0x1be)]();return _0x3f5d64['setDate'](_0x3f5d64[_0x13b71b(0x1ce)]()+_0x1888ce),await this[_0x13b71b(0x1c6)+_0x13b71b(0x1b1)+'ry'][_0x13b71b(0x207)]({'token':_0x19aa4e,'userId':_0x5eb897,'expiresAt':_0x3f5d64}),_0x19aa4e;}async[_0x38f6a8(0x1f1)+_0x38f6a8(0x1c8)](_0x2eeed8){const _0xf0fcee=_0x38f6a8;return this[_0xf0fcee(0x1c6)+_0xf0fcee(0x1b1)+'ry'][_0xf0fcee(0x1ff)+_0xf0fcee(0x1b8)]({'token':_0x2eeed8},{'userId':!![]});}async['revokeAllU'+'serTokens'](_0x20d298){const _0x126592=_0x38f6a8;return await this['serviceFac'+_0x126592(0x1c0)]['executeSer'+_0x126592(0x1d8)+_0x126592(0x213)]('refresh-to'+_0x126592(0x1e1)+_0x126592(0x209)+_0x126592(0x1e5)+_0x126592(0x1fd),async()=>{const _0x440667=_0x126592,_0x47d0bd=await this[_0x440667(0x1c6)+_0x440667(0x1b1)+'ry']['findMany']({'userId':_0x20d298,'isRevoked':![]}),_0x3b7261=[];if(_0x47d0bd[_0x440667(0x1f4)]>0x0){for(const _0x461355 of _0x47d0bd){const _0x14eaa5=await this[_0x440667(0x1b2)+'n'](_0x461355['id']);_0x14eaa5&&_0x3b7261[_0x440667(0x1b6)](_0x14eaa5);}return _0x3b7261[_0x440667(0x1f4)]>0x0?!![]:![];}return![];},_0x20d298);}async[_0x38f6a8(0x1c7)+_0x38f6a8(0x201)](){const _0x1d5ada=_0x38f6a8;return await this[_0x1d5ada(0x1d7)+_0x1d5ada(0x1c0)][_0x1d5ada(0x1b4)+'Extract'](_0x1d5ada(0x1c6)+_0x1d5ada(0x1ca)+'p-expired-'+'tokens',async()=>{const _0x17c45f=_0x1d5ada,_0x5e2a99=0x3c;this[_0x17c45f(0x211)][_0x17c45f(0x1f8)]('Starting\x20c'+'leanup\x20of\x20'+'expired\x20re'+_0x17c45f(0x1de)+_0x17c45f(0x1e8)+_0x17c45f(0x1d6)+'period\x20of\x20'+_0x5e2a99+_0x17c45f(0x1f3));const _0x17277b=this[_0x17c45f(0x20a)][_0x17c45f(0x1be)]();_0x17277b['setDate'](_0x17277b[_0x17c45f(0x1ce)]()-_0x5e2a99);const _0x4da7ab=await this[_0x17c45f(0x1c6)+_0x17c45f(0x1b1)+'ry'][_0x17c45f(0x1d0)]({'OR':[{'expiresAt':{'lt':_0x17277b}},{'isRevoked':!![],'revokedAt':{'lt':_0x17277b}}]});if(_0x4da7ab[_0x17c45f(0x1bd)]>0x0)return this[_0x17c45f(0x211)][_0x17c45f(0x1f8)](_0x17c45f(0x1ba)+'\x20'+_0x4da7ab[_0x17c45f(0x1bd)]+(_0x17c45f(0x205)+'nvalidated'+_0x17c45f(0x1fb)+'vation\x20tok'+'ens.'),_0x17c45f(0x203)+_0x17c45f(0x20c)+'ce'),{'success':!![],'count':_0x4da7ab[_0x17c45f(0x1bd)]};return{'success':![],'count':_0x4da7ab['count']};});}async[_0x38f6a8(0x1b9)+'n'](_0x185393){const _0x13c9ba=_0x38f6a8;return await this[_0x13c9ba(0x1d7)+'ilitator'][_0x13c9ba(0x1b4)+_0x13c9ba(0x1eb)]('refresh-to'+'ken-reposi'+_0x13c9ba(0x1c2)+'by-token',async()=>{const _0x85d2a8=_0x13c9ba,_0x33a5d1=this[_0x85d2a8(0x1c6)+_0x85d2a8(0x1b1)+'ry'][_0x85d2a8(0x1ff)+_0x85d2a8(0x1b8)]({'token':_0x185393},{'id':!![],'token':!![],'userId':!![],'expiresAt':!![],'isRevoked':!![],'replacedByToken':!![],'createdAt':!![],'updatedAt':!![]});if(!_0x33a5d1)throw new Error(_0x85d2a8(0x210)+_0x85d2a8(0x215));return _0x33a5d1;},_0x185393);}async[_0x38f6a8(0x1dd)+_0x38f6a8(0x1d4)+_0x38f6a8(0x1e7)](_0x3094d){const _0x14e12b=_0x38f6a8;return await this[_0x14e12b(0x1d7)+_0x14e12b(0x1c0)]['executeAnd'+_0x14e12b(0x1eb)]('refresh-to'+_0x14e12b(0x200)+_0x14e12b(0x1c2)+_0x14e12b(0x1d3)+_0x14e12b(0x1b3)+'er',async()=>{const _0x4d1803=_0x14e12b,_0x39aa30=await this[_0x4d1803(0x1c6)+_0x4d1803(0x1b1)+'ry'][_0x4d1803(0x1ee)+_0x4d1803(0x1bf)]({'userId':_0x3094d,'isRevoked':![],'expiresAt':{'gt':this[_0x4d1803(0x20a)][_0x4d1803(0x1be)]()}},{'id':!![],'token':!![],'userId':!![],'expiresAt':!![],'isRevoked':!![],'revokedAt':!![],'replacedByToken':!![],'createdAt':!![],'updatedAt':!![]});if(!_0x39aa30||_0x39aa30[_0x4d1803(0x1f4)]===0x0)throw new Error(_0x4d1803(0x214)+_0x4d1803(0x1fa)+_0x4d1803(0x1e9)+'r');return _0x39aa30;},_0x3094d);}async[_0x38f6a8(0x1b2)+'n'](_0x1be93d,_0x184db0){const _0x50b58d=_0x38f6a8;return await this[_0x50b58d(0x1d7)+'ilitator'][_0x50b58d(0x1b4)+_0x50b58d(0x1eb)](_0x50b58d(0x1e4)+_0x50b58d(0x200)+_0x50b58d(0x1c9)+_0x50b58d(0x1f7),async()=>{const _0x5cc5c8=_0x50b58d,_0x20e702=this['refreshTok'+'enReposito'+'ry'][_0x5cc5c8(0x1cd)]({'id':_0x1be93d},{'isRevoked':!![],'revokedAt':this[_0x5cc5c8(0x20a)][_0x5cc5c8(0x1be)](),..._0x184db0?{'replacedByToken':_0x184db0}:{}});if(!_0x20e702)throw new Error(_0x5cc5c8(0x210)+_0x5cc5c8(0x212)+'lready\x20rev'+'oked');return _0x20e702;});}async[_0x38f6a8(0x1b2)+_0x38f6a8(0x1fe)](_0x4cd109,_0x2f364b){const _0x3ba897=_0x38f6a8;return await this[_0x3ba897(0x1d7)+_0x3ba897(0x1c0)][_0x3ba897(0x1b4)+_0x3ba897(0x1eb)](_0x3ba897(0x1e4)+_0x3ba897(0x200)+_0x3ba897(0x1c9)+_0x3ba897(0x1da)+'-value',async()=>{const _0x3b9f5=_0x3ba897,_0x2e0f55=await this[_0x3b9f5(0x1b9)+'n'](_0x4cd109);if(!_0x2e0f55||!_0x2e0f55['id'])throw new Error(_0x3b9f5(0x210)+'found');const _0x28e935=this['revokeToke'+'n'](_0x2e0f55['id'],_0x2f364b);if(!_0x28e935)throw new Error(_0x3b9f5(0x210)+_0x3b9f5(0x212)+_0x3b9f5(0x1d2)+_0x3b9f5(0x1b5));return _0x28e935;},_0x4cd109);}async[_0x38f6a8(0x1b0)+_0x38f6a8(0x1dc)+_0x38f6a8(0x1ed)](){const _0x546c1d=_0x38f6a8;return await this[_0x546c1d(0x1d7)+_0x546c1d(0x1c0)][_0x546c1d(0x1b4)+'Extract'](_0x546c1d(0x1e4)+_0x546c1d(0x200)+_0x546c1d(0x1d1)+_0x546c1d(0x20e)+'and-revoke'+_0x546c1d(0x1f9),async()=>{const _0x158253=_0x546c1d,_0x26affb=await this['refreshTok'+_0x158253(0x1b1)+'ry'][_0x158253(0x1d0)]({'OR':[{'expiresAt':{'lt':this[_0x158253(0x20a)][_0x158253(0x1be)]()}},{'isRevoked':!![]}]});return _0x26affb[_0x158253(0x1bd)];});}};exports[_0x38f6a8(0x1c5)+_0x38f6a8(0x1e3)]=RefreshTokenService,exports[_0x38f6a8(0x1c5)+'enService']=RefreshTokenService=RefreshTokenService_1=tslib_1[_0x38f6a8(0x1b7)]([(0x0,common_1['Injectable'])(),tslib_1[_0x38f6a8(0x1d5)]('design:par'+_0x38f6a8(0x1bc),[nestjs_clock_1[_0x38f6a8(0x20b)+'ce'],nestjs_service_operation_1['ServiceFac'+_0x38f6a8(0x1cf)+_0x38f6a8(0x20f)],refresh_token_repository_1[_0x38f6a8(0x1c5)+_0x38f6a8(0x1b1)+'ry']])],RefreshTokenService);