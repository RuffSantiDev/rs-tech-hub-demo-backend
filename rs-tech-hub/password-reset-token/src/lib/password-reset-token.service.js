'use strict';const _0x3317c6=_0x50b4;(function(_0x48dde1,_0x2ae9aa){const _0x13b4b9=_0x50b4,_0x2c5d98=_0x48dde1();while(!![]){try{const _0x36eaf5=parseInt(_0x13b4b9(0x182))/0x1*(-parseInt(_0x13b4b9(0x1ae))/0x2)+parseInt(_0x13b4b9(0x1d0))/0x3*(parseInt(_0x13b4b9(0x1b5))/0x4)+-parseInt(_0x13b4b9(0x1bc))/0x5*(parseInt(_0x13b4b9(0x194))/0x6)+parseInt(_0x13b4b9(0x187))/0x7*(parseInt(_0x13b4b9(0x19c))/0x8)+-parseInt(_0x13b4b9(0x1a4))/0x9*(-parseInt(_0x13b4b9(0x1b6))/0xa)+parseInt(_0x13b4b9(0x1c7))/0xb*(parseInt(_0x13b4b9(0x1a5))/0xc)+-parseInt(_0x13b4b9(0x16f))/0xd;if(_0x36eaf5===_0x2ae9aa)break;else _0x2c5d98['push'](_0x2c5d98['shift']());}catch(_0x595bf8){_0x2c5d98['push'](_0x2c5d98['shift']());}}}(_0x4d3c,0x5734a));function _0x4d3c(){const _0x56421b=['zxHLy3v0zufUza','BMCGCgfZC3DVCG','DxnLzef0','CNzPy2u','y2XVy2S','C2HHmJu2','mtu1mLzdtMHMqq','CMfUzg9TqNL0zq','y3j5ChrV','zw4UCMvWB3nPDa','y3jLyxrLsgfZAa','y291BNq','zgvSzxrLtwfUEq','lxnLCNzPy2uTDG','nti1mte0CKzODurJ','mJuYmtjiBfnQCfi','q2XVy2Ttzxj2Aq','C2v0sg91CNm','zw5ZlG','Cg9ZAxrVCNK','CMv0zw50Aw9Uia','lxjLC2v0lxrVAW','zgf0zs4','x0vsuK9sx1rpsW','mte1mda2DwH1ueXY','C2vYDMLJzuzHyW','lI9WyxnZD29Yza','C2v0vg9Rzw5tzq','qwn0AxzHDgLVBG','u2vYDMLJzuzHyW','zMLUze1HBNK','nZmYrurKCwfJ','mtiWsuTvtu1T','DxbKyxrL','CMv2B2TLzef0','igv4CgLYzwqVCG','zcbYzxnLDcb0BW','C2vYlxrVA2vUCW','mtm2ndvHyMXVtKC','DMfSAwrHDgu','ugfZC3DVCMrszq','ru5FtK9ux0zpvq','yw10ExbLCW','Bw1VBG','AwXPDgf0B3i','Bg9N','BgvHBNvWig9Mia','Bg9Nz2vY','A2vUCYbMB3vUza','mJK1ouzNugXODG','Agv4','y3jLyxrL','ihbHC3n3B3jKia','ueftu1DpuKrFuG','CgfZC3DVCMrszq','zxnLDc10B2TLBG','DMvYAwz5','lxnLCNzPy2uTyW','oteWnxzkzLDzDq','zxjPzNK','zMLUze9UzvDPDa','zgLNzxn0','Dg9tDhjPBMC','u3rHCNrPBMCGyW','sw52ywXPzgf0Aq','B3j5','mtC2mJmZmdDuAMrdAfu','zxHWAxjLzc9Yzq','ChjLDMLVDxmTDq','DM9RzwqVDxnLza','zcbWyxnZD29Yza','zgvMAw5LuhjVCa','CgfZC3DVCMqTCG','vg9Rzw5tzxj2Aq','x19TzxrHzgf0yq','Aw52ywXPzgf0zq','rvnfvf9ut0TftG','q2XLyw5Lzcb1Ca','C2v0vg9Rzw5szq','ihrVigLUDMfSAq','y2XLyw51Cev4Ca','DwiVBMvZDgPZlq','BgvUz3rO','iezVDw5Kia','x19LC01VzhvSzq','ogX5swnHua','quXjrf9ut0TftG','BNmGD2L0AcbHia','BM93rgf0zq','uhjLDMLVDxnvCW','mtK4otrlvM5hsfa','AfnLBgvJDa','x19PBxbVCNrtDa','sw5Qzwn0ywjSzq','CMvZzxqGDg9Rzq','zgvZAwDUoNbHCG','z2v0rgf0zq','AxjLzc10B2TLBG','qhjZlxrLy2GTAa','rxH0CMfJDa','x19KzwnVCMf0zq','AxjLzfrVA2vUCW','Dg9Rzw5iyxnO','ndm4r2fPEw5k','igzVCIb1C2vYia'];_0x4d3c=function(){return _0x56421b;};return _0x4d3c();}var PasswordResetTokenService_1;Object[_0x3317c6(0x174)+'erty'](exports,_0x3317c6(0x181),{'value':!![]}),exports[_0x3317c6(0x1be)+_0x3317c6(0x1b1)+_0x3317c6(0x199)]=void 0x0;function _0x50b4(_0x12203a,_0x97a184){const _0x4d3c45=_0x4d3c();return _0x50b4=function(_0x50b414,_0x3d6cc6){_0x50b414=_0x50b414-0x168;let _0x5e674c=_0x4d3c45[_0x50b414];if(_0x50b4['zgTmua']===undefined){var _0x5c5b14=function(_0x7023e){const _0x5ec933='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1ddc33='',_0x4dca2b='';for(let _0x4c5e98=0x0,_0x5c0d0e,_0x5850ce,_0xf6ba21=0x0;_0x5850ce=_0x7023e['charAt'](_0xf6ba21++);~_0x5850ce&&(_0x5c0d0e=_0x4c5e98%0x4?_0x5c0d0e*0x40+_0x5850ce:_0x5850ce,_0x4c5e98++%0x4)?_0x1ddc33+=String['fromCharCode'](0xff&_0x5c0d0e>>(-0x2*_0x4c5e98&0x6)):0x0){_0x5850ce=_0x5ec933['indexOf'](_0x5850ce);}for(let _0x49239c=0x0,_0x2061fa=_0x1ddc33['length'];_0x49239c<_0x2061fa;_0x49239c++){_0x4dca2b+='%'+('00'+_0x1ddc33['charCodeAt'](_0x49239c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4dca2b);};_0x50b4['kwpVue']=_0x5c5b14,_0x12203a=arguments,_0x50b4['zgTmua']=!![];}const _0x4c531b=_0x4d3c45[0x0],_0x222d76=_0x50b414+_0x4c531b,_0x5a27c2=_0x12203a[_0x222d76];return!_0x5a27c2?(_0x5e674c=_0x50b4['kwpVue'](_0x5e674c),_0x12203a[_0x222d76]=_0x5e674c):_0x5e674c=_0x5a27c2,_0x5e674c;},_0x50b4(_0x12203a,_0x97a184);}const tslib_1=require('tslib'),common_1=require('@nestjs/co'+_0x3317c6(0x1c1)),nestjs_clock_1=require(_0x3317c6(0x18f)+_0x3317c6(0x17e)+_0x3317c6(0x19a)),nestjs_service_operation_1=require(_0x3317c6(0x18f)+_0x3317c6(0x17e)+'service-op'+'eration'),crypto=tslib_1[_0x3317c6(0x189)+'ar'](require(_0x3317c6(0x19e))),errors_1=require('./errors'),password_reset_token_repository_1=require(_0x3317c6(0x1b0)+_0x3317c6(0x1ab)+_0x3317c6(0x19f)+_0x3317c6(0x16e));let PasswordResetTokenService=PasswordResetTokenService_1=class PasswordResetTokenService{[_0x3317c6(0x19a)];[_0x3317c6(0x1af)+_0x3317c6(0x1c2)];[_0x3317c6(0x1cc)+_0x3317c6(0x17b)+_0x3317c6(0x1a9)];['logger']=new common_1['Logger'](PasswordResetTokenService_1['name']);constructor(_0x7023e,_0x5ec933,_0x1ddc33){const _0x3df342=_0x3317c6;this[_0x3df342(0x19a)]=_0x7023e,this['serviceFac'+_0x3df342(0x1c2)]=_0x5ec933,this[_0x3df342(0x1cc)+_0x3df342(0x17b)+_0x3df342(0x1a9)]=_0x1ddc33;}async[_0x3317c6(0x1c9)](_0x4dca2b){const _0x491342=_0x3317c6;return await this['serviceFac'+_0x491342(0x1c2)][_0x491342(0x196)+_0x491342(0x190)](_0x491342(0x175)+'eset-token'+_0x491342(0x1cf)+'reate',async()=>{const _0x26bef1=_0x491342,_0x4c5e98=crypto[_0x26bef1(0x19d)+'s'](0x20)[_0x26bef1(0x16b)](_0x26bef1(0x1c8)),_0x5c0d0e=crypto[_0x26bef1(0x1a0)]('sha256')[_0x26bef1(0x1b7)](_0x4c5e98)[_0x26bef1(0x16a)](_0x26bef1(0x1c8)),_0x5850ce=this[_0x26bef1(0x19a)][_0x26bef1(0x185)]();_0x5850ce[_0x26bef1(0x1a7)](_0x5850ce['getHours']()+0x1);const _0xf6ba21=await this[_0x26bef1(0x1cc)+'setTokenRe'+_0x26bef1(0x1a9)][_0x26bef1(0x1c9)]({'tokenHash':_0x5c0d0e,'expiresAt':_0x5850ce,'userId':_0x4dca2b});return{'token':_0x4c5e98,..._0xf6ba21};});}async[_0x3317c6(0x1bd)](_0x49239c){const _0x48cdc6=_0x3317c6;return await this[_0x48cdc6(0x1af)+'ilitator']['executeAnd'+_0x48cdc6(0x190)](_0x48cdc6(0x175)+'eset-token'+_0x48cdc6(0x1a3)+'alidate',async()=>{const _0x2734b0=_0x48cdc6,{token:_0x2061fa,userId:_0x461a80}=_0x49239c,_0x4f4368=await this[_0x2734b0(0x1cc)+_0x2734b0(0x17b)+'pository'][_0x2734b0(0x169)+_0x2734b0(0x188)]({'userId':_0x461a80,'revokedAt':null,'usedAt':null},{'id':!![],'tokenHash':!![]});if(!_0x4f4368)throw new Error(errors_1[_0x2734b0(0x1cb)+_0x2734b0(0x179)+_0x2734b0(0x1ad)+_0x2734b0(0x1bf)+'ND']);const _0x4a064a=await this[_0x2734b0(0x1ce)]({'token':_0x2061fa,'tokenHash':_0x4f4368[_0x2734b0(0x193)]});if(!_0x4a064a)throw new Error(errors_1[_0x2734b0(0x1cb)+_0x2734b0(0x179)+'_ERROR_INV'+_0x2734b0(0x183)]);else return await this[_0x2734b0(0x1cc)+_0x2734b0(0x17b)+_0x2734b0(0x1a9)][_0x2734b0(0x1b7)]({'id':_0x4f4368['id']},{'usedAt':this[_0x2734b0(0x19a)][_0x2734b0(0x185)]()}),!![];});}async[_0x3317c6(0x1ce)](_0x1f4fd3){const _0x55159a=_0x3317c6;return await this['serviceFac'+_0x55159a(0x1c2)]['executeAnd'+_0x55159a(0x190)](_0x55159a(0x175)+_0x55159a(0x1cd)+_0x55159a(0x1a3)+_0x55159a(0x168),async()=>{const _0x305ad2=_0x55159a,{token:_0x581bf7,tokenHash:_0x5b7aaf}=_0x1f4fd3,_0x296342=crypto[_0x305ad2(0x1a0)](_0x305ad2(0x19b))[_0x305ad2(0x1b7)](_0x581bf7)[_0x305ad2(0x16a)](_0x305ad2(0x1c8));if(_0x296342!==_0x5b7aaf)return![];return!![];},_0x1f4fd3);}async[_0x3317c6(0x178)+_0x3317c6(0x186)+'erTokens'](_0x13dda4){const _0x4199b5=_0x3317c6;return await this[_0x4199b5(0x1af)+_0x4199b5(0x1c2)][_0x4199b5(0x196)+_0x4199b5(0x190)](_0x4199b5(0x175)+_0x4199b5(0x1cd)+'-service-i'+'nvalidate-'+_0x4199b5(0x171)+_0x4199b5(0x1bb),async()=>{const _0x5aceb1=_0x4199b5,_0x5942ae=await this[_0x5aceb1(0x1cc)+_0x5aceb1(0x17b)+'pository'][_0x5aceb1(0x1b4)]({'userId':_0x13dda4});if(!_0x5942ae||_0x5942ae[_0x5aceb1(0x17f)]===0x0)return this[_0x5aceb1(0x1c5)][_0x5aceb1(0x1c3)]('No\x20passwor'+_0x5aceb1(0x1ba)+_0x5aceb1(0x1c6)+_0x5aceb1(0x195)+_0x13dda4+(_0x5aceb1(0x17c)+_0x5aceb1(0x1ac)),_0x5aceb1(0x1b2)+_0x5aceb1(0x176)+'ce'),![];this[_0x5aceb1(0x1c5)][_0x5aceb1(0x1c3)](_0x5aceb1(0x180)+_0x5942ae[_0x5aceb1(0x17f)]+('\x20password\x20'+_0x5aceb1(0x18b)+'ns\x20for\x20use'+'r\x20')+_0x13dda4+(_0x5aceb1(0x17c)+'date.'));for(const _0x57dec6 of _0x5942ae){this[_0x5aceb1(0x1c5)][_0x5aceb1(0x1c3)](_0x5aceb1(0x16d)+_0x5aceb1(0x197)+_0x5aceb1(0x1ba)+'ken\x20'+_0x57dec6['id']+_0x5aceb1(0x195)+_0x13dda4+'.','Activation'+_0x5aceb1(0x176)+'ce'),_0x57dec6[_0x5aceb1(0x1b8)]===null&&_0x57dec6[_0x5aceb1(0x198)]===null&&await this[_0x5aceb1(0x1cc)+_0x5aceb1(0x17b)+_0x5aceb1(0x1a9)][_0x5aceb1(0x1b7)]({'id':_0x57dec6['id']},{'isRevoked':!![],'revokedAt':this[_0x5aceb1(0x19a)]['nowDate']()});}return!![];},_0x13dda4);}async[_0x3317c6(0x17d)+_0x3317c6(0x192)](){const _0x5572e1=_0x3317c6;return await this[_0x5572e1(0x1af)+_0x5572e1(0x1c2)][_0x5572e1(0x196)+_0x5572e1(0x190)]('password-r'+'eset-token'+_0x5572e1(0x1cf)+'leanup-exp'+_0x5572e1(0x18e)+'s',async()=>{const _0x5163d2=_0x5572e1,_0xcea09f=0x3c;this['logger'][_0x5163d2(0x1c3)](_0x5163d2(0x16c)+_0x5163d2(0x1c4)+_0x5163d2(0x170)+_0x5163d2(0x172)+_0x5163d2(0x1ca)+'reset\x20toke'+_0x5163d2(0x184)+_0x5163d2(0x1aa)+'period\x20of\x20'+_0xcea09f+'\x20days.');const _0x5e077a=this['clock'][_0x5163d2(0x185)]();_0x5e077a['setDate'](_0x5e077a[_0x5163d2(0x18d)]()-_0xcea09f);const _0x65b8f1=await this['passwordRe'+_0x5163d2(0x17b)+_0x5163d2(0x1a9)][_0x5163d2(0x1a2)]({'OR':[{'expiresAt':{'lt':_0x5e077a}},{'revokedAt':{'lt':_0x5e077a}},{'usedAt':{'lt':_0x5e077a}}]});if(_0x65b8f1[_0x5163d2(0x1a1)]>0x0)return this[_0x5163d2(0x1c5)][_0x5163d2(0x1c3)](_0x5163d2(0x17a)+'\x20'+_0x65b8f1[_0x5163d2(0x1a1)]+(_0x5163d2(0x1b9)+'evoked/use'+_0x5163d2(0x173)+'\x20reset\x20tok'+_0x5163d2(0x1a8))),{'success':!![],'count':_0x65b8f1[_0x5163d2(0x1a1)]};return{'success':![],'count':_0x65b8f1['count']};});}};exports['PasswordRe'+_0x3317c6(0x1b1)+_0x3317c6(0x199)]=PasswordResetTokenService,exports['PasswordRe'+_0x3317c6(0x1b1)+_0x3317c6(0x199)]=PasswordResetTokenService=PasswordResetTokenService_1=tslib_1[_0x3317c6(0x191)]([(0x0,common_1[_0x3317c6(0x18a)])(),tslib_1[_0x3317c6(0x177)](_0x3317c6(0x18c)+_0x3317c6(0x1c0),[nestjs_clock_1[_0x3317c6(0x1a6)+'ce'],nestjs_service_operation_1[_0x3317c6(0x1b3)+'ilitatorSe'+_0x3317c6(0x199)],password_reset_token_repository_1['PasswordRe'+_0x3317c6(0x17b)+_0x3317c6(0x1a9)]])],PasswordResetTokenService);